git add .
git commit -m "chore: setup firebase hosting github actions"
git push origin main
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Training & Recertification Tracker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        @media print {
            .print-hidden { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; padding: 0; margin: 0; }
            @page { margin: 1cm; }
        }
        .print-only { display: none; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, doc, onSnapshot, query, Timestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const manualConfig = {
            apiKey: "AIzaSyC9zQJKQz1_rCvPnrKSX-rKFcWqvLbctGA",
            authDomain: "panda-training.firebaseapp.com",
            projectId: "panda-training",
            storageBucket: "panda-training.firebasestorage.app",
            messagingSenderId: "472137924180",
            appId: "1:472137924180:web:a5e2a285ea6d1ad5caf7c1"
        };

        let firebaseConfig = null;
        let appId = 'panda-training-tracker-prod';

        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                firebaseConfig = JSON.parse(__firebase_config);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'panda-training-tracker';
            } else {
                firebaseConfig = manualConfig;
            }

            if (firebaseConfig) {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                window.PandaDB = { 
                    db, auth, collection, addDoc, doc, onSnapshot, query, Timestamp, 
                    signInAnonymously, signInWithCustomToken, onAuthStateChanged, appId,
                    initialized: true
                };
            } else {
                window.PandaDB = { initialized: false, error: "Firebase Config Missing" };
            }
        } catch (error) {
            window.PandaDB = { initialized: false, error: error.message };
        }
    </script>

    <script type="text/babel">
        const COOKS_LIST = [
            "Ryan Glick", "Derrick Ross", "Paresh Devlekar", "Paras Mittal",
            "Sivanesh Murthi", "Vatstalya Nallagangula", "Gurudeep Paleti", "Omkar Salkade", "Sai Keithireddy"
        ];

        const { useState, useEffect, useMemo } = React;

        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard');
            const [records, setRecords] = useState([]);
            const [loading, setLoading] = useState(true);
            const [submitting, setSubmitting] = useState(false);
            const [message, setMessage] = useState(null);
            const [aiLoading, setAiLoading] = useState(false);
            const [aiResponse, setAiResponse] = useState(null);
            const [connError, setConnError] = useState(null);
            const [customName, setCustomName] = useState('');
            
            const apiKey = ""; 

            const [formData, setFormData] = useState({
                cookName: COOKS_LIST[0],
                role: 'Cook',
                kitchenScore: '',
                writtenScore: '',
                completionDate: new Date().toISOString().split('T')[0],
                conductedBy: '',
                nextTestDate: '',
                status: 'Certified',
                notes: ''
            });

            useEffect(() => {
                let attempts = 0;
                const checkDB = setInterval(() => {
                    attempts++;
                    if (window.PandaDB) {
                        clearInterval(checkDB);
                        if (!window.PandaDB.initialized) {
                            setConnError(`Config Missing. Check manualConfig in script.`);
                            setLoading(false);
                            return;
                        }

                        const { auth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = window.PandaDB;
                        
                        const initAuth = async () => {
                            try {
                                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                    await signInWithCustomToken(auth, __initial_auth_token);
                                } else {
                                    await signInAnonymously(auth);
                                }
                            } catch (e) {
                                setConnError("Login failed. Enable 'Anonymous Sign-in' in Firebase Auth.");
                                setLoading(false);
                            }
                        };
                        
                        initAuth();
                        const unsubscribe = onAuthStateChanged(auth, setUser);
                        return () => unsubscribe();
                    }
                    if (attempts > 60) {
                        clearInterval(checkDB);
                        setConnError("Database timeout.");
                        setLoading(false);
                    }
                }, 100);
                return () => clearInterval(checkDB);
            }, []);

            useEffect(() => {
                if (!user || !window.PandaDB || !window.PandaDB.initialized) return;
                const { db, collection, onSnapshot, appId } = window.PandaDB;
                const q = collection(db, 'artifacts', appId, 'public', 'data', 'training_logs');
                
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setRecords(data.sort((a, b) => new Date(b.completionDate) - new Date(a.completionDate)));
                    setLoading(false);
                }, (error) => {
                    setConnError("Access denied. Check Firestore rules.");
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            useEffect(() => {
                if (window.lucide) lucide.createIcons();
            }, [view, records, aiResponse, loading]);

            const stats = useMemo(() => {
                const total = records.length;
                const certified = records.filter(r => r.status === 'Certified').length;
                const inProgress = records.filter(r => r.status === 'In Progress').length;
                const retake = records.filter(r => r.status === 'Needs Retake').length;
                return {
                    total, certified, inProgress, retake,
                    certifiedPct: total ? (certified / total) * 100 : 0,
                    inProgressPct: total ? (inProgress / total) * 100 : 0,
                    retakePct: total ? (retake / total) * 100 : 0
                };
            }, [records]);

            const upcomingRetakes = useMemo(() => {
                return records
                    .filter(r => r.nextTestDate && new Date(r.nextTestDate) >= new Date())
                    .sort((a, b) => new Date(a.nextTestDate) - new Date(b.nextTestDate))
                    .slice(0, 5);
            }, [records]);

            const callGemini = async (prompt) => {
                setAiLoading(true);
                const delays = [1000, 2000, 4000, 8000, 16000];
                for (let i = 0; i <= delays.length; i++) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                systemInstruction: { parts: [{ text: "Regional Analyst. Performance insights." }] }
                            })
                        });
                        if (response.ok) {
                            const result = await response.json();
                            setAiLoading(false);
                            return result.candidates?.[0]?.content?.parts?.[0]?.text;
                        }
                    } catch (err) { if (i === delays.length) break; }
                    if (i < delays.length) await new Promise(res => setTimeout(res, delays[i]));
                }
                setAiLoading(false);
                return null;
            };

            const handleGetInsights = async () => {
                if (records.length === 0) return;
                const summary = records.map(r => `${r.cookName}: K:${r.kitchenScore}, W:${r.writtenScore}, ${r.status}`).join('\n');
                const res = await callGemini(`Analyze trends and spotlight cooks: \n${summary}`);
                if (res) setAiResponse({ title: "Analysis", content: res });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!user || !window.PandaDB) return;
                
                const finalName = formData.cookName === 'Other' ? customName : formData.cookName;
                if (!finalName) return;

                setSubmitting(true);
                const { db, collection, addDoc, Timestamp, appId } = window.PandaDB;
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'training_logs'), {
                        ...formData,
                        cookName: finalName,
                        kitchenScore: Number(formData.kitchenScore),
                        writtenScore: Number(formData.writtenScore),
                        timestamp: Timestamp.now(),
                        userId: user.uid
                    });
                    setMessage({ type: 'success', text: 'Saved!' });
                    setFormData({ cookName: COOKS_LIST[0], role: 'Cook', kitchenScore: '', writtenScore: '', completionDate: new Date().toISOString().split('T')[0], conductedBy: '', nextTestDate: '', status: 'Certified', notes: '' });
                    setCustomName('');
                    setTimeout(() => { setView('dashboard'); setMessage(null); setSubmitting(false); }, 1000);
                } catch (e) {
                    setSubmitting(false);
                }
            };

            if (connError) {
                return (
                    <div className="h-screen flex items-center justify-center p-8 bg-red-50 text-center">
                        <div className="bg-white p-8 rounded-3xl shadow-xl border border-red-100 max-w-sm">
                            <h1 className="text-xl font-black text-red-700 mb-2">Sync Error</h1>
                            <p className="text-xs text-slate-400 mb-6">{connError}</p>
                            <button onClick={() => window.location.reload()} className="w-full bg-red-700 text-white py-3 rounded-xl font-black uppercase text-xs">Retry</button>
                        </div>
                    </div>
                );
            }

            if (loading) {
                return (
                    <div className="h-screen flex items-center justify-center bg-white">
                        <div className="w-10 h-10 border-4 border-slate-100 border-t-red-600 rounded-full animate-spin"></div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-24 print:pb-0">
                    <header className="bg-red-700 text-white p-4 shadow-xl sticky top-0 z-40 print-hidden">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <h1 className="font-black text-xl italic tracking-tighter uppercase">UF Panda Cook Scorecard</h1>
                            <div className="flex gap-2">
                                <button onClick={() => window.print()} className="bg-red-800 p-2 rounded-xl w-10 h-10 flex items-center justify-center"><i data-lucide="printer" className="w-5 h-5"></i></button>
                                <button onClick={() => setView('log')} className="bg-white text-red-700 px-4 py-2 rounded-xl text-xs font-black uppercase">New Eval</button>
                            </div>
                        </div>
                    </header>

                    {message && <div className="fixed top-20 right-4 z-50 p-4 rounded-2xl bg-green-500 text-white font-bold">{message.text}</div>}

                    <main className="max-w-4xl mx-auto p-4 print:p-0">
                        {aiResponse && (
                            <div className="mb-6 bg-slate-900 text-white p-6 rounded-[2rem] shadow-2xl relative print-hidden">
                                <div className="flex justify-between items-start mb-4">
                                    <h3 className="text-xs font-black uppercase tracking-widest text-emerald-400">Analysis</h3>
                                    <button onClick={() => setAiResponse(null)} className="p-2 bg-slate-800 rounded-lg">âœ•</button>
                                </div>
                                <div className="text-sm whitespace-pre-wrap leading-relaxed">{aiResponse.content}</div>
                            </div>
                        )}

                        {view === 'dashboard' && (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col items-center">
                                        <p className="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-6">Certification Progress</p>
                                        <div className="relative h-32 w-32 mb-6">
                                            <svg viewBox="0 0 36 36" className="h-32 w-32 transform -rotate-90">
                                                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#f1f5f9" strokeWidth="4" />
                                                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#16a34a" strokeWidth="4" strokeDasharray={`${stats.certifiedPct} 100`} />
                                                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#3b82f6" strokeWidth="4" strokeDasharray={`${stats.inProgressPct} 100`} strokeDashoffset={`-${stats.certifiedPct}`} />
                                                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#ef4444" strokeWidth="4" strokeDasharray={`${stats.retakePct} 100`} strokeDashoffset={`-${stats.certifiedPct + stats.inProgressPct}`} />
                                            </svg>
                                            <div className="absolute inset-0 flex items-center justify-center font-black text-2xl tracking-tighter">{Math.round(stats.certifiedPct)}%</div>
                                        </div>
                                        <div className="w-full text-[10px] font-black uppercase space-y-2">
                                            <div className="flex justify-between items-center"><span className="flex items-center gap-1.5"><div className="w-2 h-2 rounded-full bg-green-500"></div>Certified</span> <span className="text-green-600">{stats.certified}</span></div>
                                            <div className="flex justify-between items-center"><span className="flex items-center gap-1.5"><div className="w-2 h-2 rounded-full bg-blue-500"></div>In Progress</span> <span className="text-blue-500">{stats.inProgress}</span></div>
                                            <div className="flex justify-between items-center"><span className="flex items-center gap-1.5"><div className="w-2 h-2 rounded-full bg-red-500"></div>Retake</span> <span className="text-red-500">{stats.retake}</span></div>
                                        </div>
                                    </div>

                                    <div className="md:col-span-2 space-y-4">
                                        <div className="bg-slate-900 text-white p-6 rounded-[2rem] flex items-center justify-between border border-slate-800 shadow-xl">
                                            <div>
                                                <h3 className="font-black uppercase text-xs tracking-widest italic mb-1">Performance Analysis</h3>
                                                <p className="text-[10px] text-slate-400 font-bold">AI Trends</p>
                                            </div>
                                            <button onClick={handleGetInsights} disabled={aiLoading} className="bg-emerald-600 text-white px-6 py-3 rounded-2xl font-black uppercase text-[10px]">
                                                {aiLoading ? '...' : 'Analyze'}
                                            </button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-white p-5 rounded-[1.5rem] border border-slate-200 shadow-sm text-center">
                                                <p className="text-[9px] font-black text-slate-400 uppercase">Team Size</p>
                                                <p className="text-3xl font-black text-slate-800">{COOKS_LIST.length}</p>
                                            </div>
                                            <div className="bg-white p-5 rounded-[1.5rem] border border-slate-200 shadow-sm text-center text-red-600">
                                                <p className="text-[9px] font-black uppercase">Logs</p>
                                                <p className="text-3xl font-black">{records.length}</p>
                                            </div>
                                        </div>
                                        <div className="bg-red-50 p-6 rounded-[2rem] border border-red-100">
                                            <h4 className="text-[10px] font-black text-red-800 uppercase mb-4 flex items-center gap-2"><i data-lucide="calendar" className="w-3 h-3"></i> Upcoming Tests</h4>
                                            <div className="space-y-2">
                                                {upcomingRetakes.length === 0 ? <p className="text-xs text-red-400 font-bold uppercase italic tracking-tight">None scheduled.</p> :
                                                    upcomingRetakes.map(r => (
                                                        <div key={r.id} className="bg-white p-3 rounded-2xl flex justify-between items-center text-xs shadow-sm">
                                                            <span className="font-black uppercase">{r.cookName}</span>
                                                            <span className="font-black text-red-600">{r.nextTestDate}</span>
                                                        </div>
                                                    ))
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-sm">
                                    <div className="p-6 bg-slate-50 font-black uppercase text-xs tracking-widest border-b border-slate-100">Performance Data (must be 90% or higher)</div>
                                    <table className="w-full text-left text-xs">
                                        <thead className="bg-slate-50 text-slate-400 font-black uppercase tracking-widest">
                                            <tr>
                                                <th className="px-6 py-4">Date</th>
                                                <th className="px-6 py-4">Employee</th>
                                                <th className="px-6 py-4 text-center">Score (K/W)</th>
                                                <th className="px-6 py-4 text-center">By</th>
                                                <th className="px-6 py-4 text-right">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {records.map(r => (
                                                <tr key={r.id} className="hover:bg-red-50/20">
                                                    <td className="px-6 py-5 font-bold text-slate-400">{r.completionDate}</td>
                                                    <td className="px-6 py-5 font-black uppercase text-sm">{r.cookName}</td>
                                                    <td className="px-6 py-5 text-center font-black text-red-600">{r.kitchenScore}% / {r.writtenScore}%</td>
                                                    <td className="px-6 py-5 text-center font-bold text-slate-400 italic uppercase text-[10px]">{r.conductedBy || '---'}</td>
                                                    <td className="px-6 py-5 text-right">
                                                        <span className={`px-3 py-1 rounded-full text-[9px] font-black uppercase border ${r.status === 'Certified' ? 'bg-green-100 text-green-700 border-green-200' : 'bg-red-100 text-red-700 border-red-200'}`}>{r.status}</span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {view === 'log' && (
                            <div className="bg-white p-8 rounded-[2.5rem] border border-slate-200 max-w-xl mx-auto shadow-2xl">
                                <h2 className="text-2xl font-black uppercase italic mb-8 flex items-center gap-3"><i data-lucide="edit-3"></i> Log Eval</h2>
                                <form onSubmit={handleSubmit} className="space-y-6">
                                    <div className="space-y-2">
                                        <label className="text-[10px] font-black uppercase text-slate-400 block tracking-widest">Employee</label>
                                        <select 
                                            value={formData.cookName} 
                                            onChange={e => setFormData({...formData, cookName: e.target.value})} 
                                            className="w-full p-4 rounded-2xl border-2 border-slate-100 font-black text-lg bg-slate-50 outline-none"
                                        >
                                            {COOKS_LIST.map(n => <option key={n} value={n}>{n}</option>)}
                                            <option value="Other">Other (New Employee)</option>
                                        </select>
                                        {formData.cookName === 'Other' && (
                                            <input 
                                                required 
                                                type="text" 
                                                placeholder="Enter Full Name" 
                                                value={customName} 
                                                onChange={e => setCustomName(e.target.value)} 
                                                className="w-full p-4 mt-2 rounded-2xl border-2 border-red-50 bg-red-50/30 font-bold outline-none border-t-red-200 focus:border-red-400" 
                                            />
                                        )}
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="text-[10px] font-black uppercase text-slate-400 block mb-2">Test Date</label>
                                            <input type="date" value={formData.completionDate} onChange={e => setFormData({...formData, completionDate: e.target.value})} className="w-full p-4 rounded-2xl border-2 border-slate-100 font-bold" />
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-black uppercase text-slate-400 block mb-2">Evaluator</label>
                                            <input required type="text" value={formData.conductedBy} onChange={e => setFormData({...formData, conductedBy: e.target.value})} className="w-full p-4 rounded-2xl border-2 border-slate-100 font-bold" placeholder="Your Name" />
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <input required type="number" placeholder="Kitchen %" value={formData.kitchenScore} onChange={e => setFormData({...formData, kitchenScore: e.target.value})} className="w-full p-4 rounded-2xl border-2 border-slate-100 font-black text-red-600" />
                                        <input required type="number" placeholder="Written %" value={formData.writtenScore} onChange={e => setFormData({...formData, writtenScore: e.target.value})} className="w-full p-4 rounded-2xl border-2 border-slate-100 font-black text-red-600" />
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-black uppercase text-slate-400 block mb-2">Status</label>
                                        <select value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})} className="w-full p-4 rounded-2xl border-2 border-slate-100 font-bold uppercase text-xs">
                                            <option>Certified</option><option>In Progress</option><option>Needs Retake</option>
                                        </select>
                                    </div>
                                    {formData.status !== 'Certified' && (
                                        <div className="animate-in fade-in slide-in-from-right-4">
                                            <label className="text-[10px] font-black uppercase text-red-400 block mb-2 font-bold"><i data-lucide="calendar" className="w-3 h-3"></i> Retake Date</label>
                                            <input type="date" value={formData.nextTestDate} onChange={e => setFormData({...formData, nextTestDate: e.target.value})} className="w-full p-4 rounded-2xl border-2 border-red-100 bg-red-50 font-bold text-red-700" />
                                        </div>
                                    )}
                                    <div className="flex gap-4 pt-4">
                                        <button type="button" onClick={() => setView('dashboard')} className="flex-1 p-4 rounded-2xl border-2 border-slate-100 font-black uppercase text-xs">Cancel</button>
                                        <button type="submit" disabled={submitting} className="flex-[2] p-4 bg-red-700 text-white rounded-2xl font-black uppercase text-xs shadow-xl">{submitting ? '...' : 'Publish'}</button>
                                    </div>
                                </form>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-slate-100 px-8 py-4 z-40 print-hidden">
                        <div className="max-w-md mx-auto flex justify-around">
                            <button onClick={() => setView('dashboard')} className={`flex flex-col items-center gap-1 ${view === 'dashboard' ? 'text-red-700 font-bold scale-110' : 'text-slate-300'}`}>
                                <i data-lucide="layout-dashboard"></i><span className="text-[8px] font-black uppercase">Home</span>
                            </button>
                            <button onClick={() => setView('log')} className={`flex flex-col items-center gap-1 ${view === 'log' ? 'text-red-700 font-bold scale-110' : 'text-slate-300'}`}>
                                <i data-lucide="plus-circle"></i><span className="text-[8px] font-black uppercase">Log Score</span>
                            </button>
                        </div>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
